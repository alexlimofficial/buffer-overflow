/* vulnerable.c
 * Compile: gcc -fno-stack-protector -z execstack -o vulnerable vulnerable.c
 */

#include <stdio.h>
#include <unistd.h>

int vuln() {
    char buf[80];	// 80-byte buffer
    int r;		

    /*
     * ssize_t read(int fildes, void *buf, size_t nbytes);
     * int fildes - file description of where to read the input (0 for std input)
     * buf - character array where the read content will be stored
     * size_t nbytes - number of bytes to read before truncating the data
     *
     * What it does: reads 400 bytes from standard input to buf
     * The problem: 400 bytes into 80-bytes buf --> overflow!
     */
    r = read(0, buf, 400);	
    printf("\nRead %d bytes. buf is %s\n", r, buf);

    /*
     * <stdio.h>
     * Write's a string to stdout up to but not including the null character.
     * Newline character appended to output.
     */
    puts("Returned properly.");
    return 0;
}

int main(int argc, char *argv[]) {
    printf("Try to exec /bin/sh");
    vuln();
    return 0;
}
